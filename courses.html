<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smile School</title>

    <!--Bootstrap 4.4.1-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!--Fonts-->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Coiny&display=swap" rel="stylesheet">

    <!--Stylesheet and icon-->
    <link rel="stylesheet" href="courses_styles.css">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">

    <!-- Jquery import -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body class="text-white container-xxl p-0">
    <!--Main section-->
    <section class="courses-header">
        <!--Header and Nav links-->
        <nav class="navbar navbar-expand-sm navbar-light">
            <div class="d-flex container-xl mt-4 px-sm-5">
                <!--Desktop/tablet logo container-->
                <div class="d-none d-sm-block">
                  <a
                  class="navbar-brand mx-auto d-flex flex-column flex-sm-row align-items-center mt-3 just"
                  href="homepage.html"
                  >
                    <img
                      src="images/smile_off.png"
                      alt="navbar-logo"
                      width="37px"
                      class="me-4 mb-3 mb-sm-0 me-sm-3 img-fluid"
                    />
                    <img
                      src="images/logo.png"
                      alt="navbar-logo-text"
                      width="114px"
                      class="me-4 img-fluid"
                    />
                  </a>
                </div>
                <!--Mobile container-->
                <div class="d-flex d-sm-none mb-3 mt-3 pb-5 mb-sm-0 pb-sm-0 mt-sm-0">
                    <!--Toggle button for mobile nav-->
                    <button class="navbar-toggler border-0 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <!--Stacked logo for mobile view-->
                    <a href="#" class="navbar-brand">
                        <img src="images/logo-sm.png" alt="header_logo_small" class="position-absolute start-50 mt-4 translate-middle">
                    </a>
                </div>
                <!--Navbar Links-->
                <div class="collapse navbar-collapse justify-content-sm-end align-center text-center mt-1 mt-sm-0" id="main-nav">
                    <ul class="navbar-nav fw-bold">
                        <li class="nav-item me-sm-5 mb-3 mb-sm-0">
                            <a class="nav-link text-white fs-6 hover-underline-animation" href="courses.html">COURSES</a>
                        </li>
                        <li class="nav-item me-sm-5 mb-3 mb-sm-0">
                            <a class="nav-link text-white fs-6 hover-underline-animation" href="pricing.html">PRICING</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-white fs-6 hover-underline-animation" href="index.html">LOGIN</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!--Title-->
        <div class="d-flex flex-column justify-content-center">
            <h1 class="h2 text-center d-none d-sm-block coiny my-5">« Don’t cry because it’s over.
                <br><span class="text-primary">Smile</span> because it happened. »</h1>
        </div>
    </section>
    <!--Form section-->
    <section class="form-section">
        <!--Search form-->
        <div class="container-xxl bg-primary py-4">
            <div class="container-lg">
                <div class="row">
                    <form class="col-lg-4 col-sm-12 col-12">
                        <div class="mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16" class="search-icon">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                            <label for="keywords" class="form-label fs-7">KEYWORDS</label>
                            <input type="text" class="form-control form-control-lg" placeholder="Search by keywords" id="keywords" aria-describedby="keywords">
                        </div>
                    </form>
                    <form class="col-lg-4 col-sm-6 col-12 mb-3">
                        <label for="topic" class="form-label fs-7">TOPIC</label>
                        <select class="form-select form-select-lg text-white fw-light select-opacity" aria-label="Default select example" id="topic-menu">
                        </select>
                    </form>
                    <form class="col-lg-4 col-sm-6 col-12 mb-3">
                        <label for="exampleInputEmail1" class="form-label fs-7">SORT BY</label>
                        <select class="form-select form-select-lg text-white fw-light select-opacity" aria-label="Default select example" id="sort-menu">
                        </select>
                    </form>
                </div>
            </div>
        </div>
    </section>
    <!--Video results section-->
    <section class="video-result-section d-flex flex-column">
      <div class="container-xl mt-5">
        <p class="fs-6 text-secondary mb-5" id="result-total"></p>
        <div class="row results">
        </div>
      </div>
    </section>
    <!--Footer-->
    <footer class="footer">
        <div class="container-xxl bg-secondary pt-5 pb-3 mt-5 d-flex flex-column">
            <div class="d-flex flex-sm-row flex-column justify-content-sm-between justify-content-center align-items-center">
                <img src="images/logo2.png" alt="footer-logo" class="footer-logo mt-0 mt-sm-3 mb-3">
                <img src="images/social_icons.png" alt="socials" class="footer-socials my-3">
            </div>
            <p class="text-center text-secondary mt-3 mt-md-5 mb-0">©smileschool 2020</p>
        </div>
    </footer>

    <!-- Jquery Scripting -->
    <script type="application/javascript">
      $(function() {
        // Function loads search parameters
        function loadSearchParameters () { 
          // Api request to get form data
          $.ajax({
            url: 'https://smileschool-api.hbtn.info/courses',
            method: 'GET',
            dataType: 'json',
            success: (data) => {
              // Recieved request
              // Apply topic keywords
              const topics = data.topics;
              const topicMenu = $('#topic-menu');

              // console.log(topics);
              $.each(topics, (index, topic) => {
                const topicUpper = topic.charAt(0).toUpperCase() + topic.slice(1);
                
                if (index == 0) {
                  const dropdownLink = $('<option>', {
                    selected: ''
                  }).text(topicUpper);

                  topicMenu.append(dropdownLink);

                } else {
                  const dropdownLink = $('<option>', {
                    value: `${index}`
                  }).text(topicUpper);

                  topicMenu.append(dropdownLink);
                }

                // console.log(topic);
              });

              // Apply sort by keywords
              const sorts = data.sorts;
              const sortMenu = $('#sort-menu');

              $.each(sorts, (index, sort) => {
                const sortUpper = sort.charAt(0).toUpperCase() + sort.slice(1);
                const sortUpperWithSpaces = sortUpper.replace(/_/g, ' ');
                
                if (index == 0) {
                  const dropdownLink = $('<option>', {
                    selected: ''
                  }).text(sortUpperWithSpaces);

                  sortMenu.append(dropdownLink);

                } else {
                  const dropdownLink = $('<option>', {
                    value: `${index}`
                  }).text(sortUpperWithSpaces);

                  sortMenu.append(dropdownLink);
                }

                // console.log(topic);
                // Call ajax search to initally load videos
                ajaxSearch();
              });
            },
            error: (error) => {
              // Request did not go through
              console.error('Error:', error);
            }
          });
        }

        // Attaching event handler to topic/sort menu and keywords enter keypress
        $('#topic-menu, #sort-menu').on('change', ajaxSearch);
        $('#keywords').on('keypress', (event) => {
          if (event.which === 13) {
            event.preventDefault();
            ajaxSearch();
          }
        });

        function ajaxSearch() {
            // Get form values
            const keywords = $('#keywords').val();
            const topicIndex = $('#topic-menu').val();
            const sortIndex = $('#sort-menu').val();

            // Map form values to API parameters
            const topic = ["all", "novice", "intermediate", "expert"][topicIndex];
            const sort = ["most_popular", "most_recent", "most_viewed"][sortIndex];

            // Make AJAX request
            $.ajax({
                url: 'https://smileschool-api.hbtn.info/courses',
                method: 'GET',
                dataType: 'json',
                data: { topic, sort, q: keywords },
                success: (data) => {
                // Clear previous results
                $('.results').empty();

                // Display total number of results
                $('#result-total').text(`${data.courses.length} videos`);

                // Append new cards based on the returned data
                data.courses.forEach(course => {
                    const card = `
                    <div class="card col-lg-3 col-sm-4 mb-4 col-12 px-3 border-0">
                        <div class="card-thumbnail position-relative">
                            <img src="${course.thumb_url}" class="card-img-top" alt="${course.title}">
                            <img src="images/play.png" class="play-button" alt="play button">
                        </div>
                        <div class="card-body">
                            <h5 class="card-title fw-bold">${course.title}</h5>
                            <p class="card-text text-secondary">${course['sub-title']}</p>
                            <div class="row ps-2">
                                <img src="${course.author_pic_url}" alt="tiny-${course.author}" class="tutorial_tiny_image col p-0 rounded-5">
                                <p class="text-primary fw-bold fs-6 col-6 mt-1 mb-0 text-start text-nowrap ps-3">${course.author}</p>
                            </div>
                            <div class="info pt-3 d-flex justify-content-between align-items-center">
                                <div class="rating d-flex">
                                    ${'<img src="images/star_on.png" alt="star on" style="width: 15px; height: 15px;">'.repeat(course.star)}
                                    ${'<img src="images/star_off.png" alt="star off" style="width: 15px; height: 15px;">'.repeat(5 - course.star)}
                                </div>
                                <span class="text-primary fw-bold text-nowrap">${course.duration}</span>
                            </div>
                        </div>
                    </div>
                    `;
                    $('.results').append(card);
                });
                },
                error: (error) => {
                console.error('Error:', error);
                }
            });
            }

        // Call function to load search parameters
        loadSearchParameters();
      });
    </script>

    <!-- JQuery Import -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!--Javascript-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>
